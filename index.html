<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>숫자 입력 페이지</title>
    <style>
        body {
            font-family: Arial, sans-serif;
            background-color: #f0f0f0;
            text-align: center;
            margin-top: 50px;
        }

        .container {
            max-width: 400px;
            margin: 0 auto;
            padding: 20px;
            background-color: #fff;
            border-radius: 10px;
            box-shadow: 0px 0px 10px rgba(0, 0, 0, 0.1);
        }

        h1 {
            color: #333;
        }

        /* 숫자 버튼 스타일 */
        .number-buttons {
            display: block;
            margin-top: 20px;
        }

        .number-buttons .button-row {
            display: flex;
            justify-content: center;
            margin-bottom: 15px; /* 간격 조정 */
        }

        .number-buttons button {
            width: 30%;
            background-color: #007bff;
            color: #fff;
            border: none;
            padding: 12px 0;
            border-radius: 5px;
            cursor: pointer;
            font-size: 20px;
            transition: background-color 0.3s ease;
            height: 50px; /* 높이 통일 */
            line-height: 1;
            margin: 0 5px; /* 버튼 간격 추가 */
        }

        .number-buttons button:hover {
            background-color: #0056b3;
        }

        .number-buttons button.epic {
            background-color: #333;
        }

        .number-buttons button.epic:hover {
            background-color: grey;
        }

        .number-buttons button.rand {
            background-color: #e33f3f;
        }

        .number-buttons button.rand:hover {
            background-color: grey;
        }

        /* 숫자 입력폼 스타일 */
        .number-input {
            width: calc(100% - 30px);
            padding: 10px;
            margin-top: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
            height: 50px; /* 높이 통일 */
        }

        /* 검색 입력폼 스타일 */
        .search-input {
            width: calc(70% - 22px);
            margin-right: 10px;
            height: 40px;
            padding: 10px;
            border: 1px solid #ccc;
            border-radius: 5px;
            font-size: 16px;
            box-sizing: border-box;
        }

        .search-section {
            margin-top: 40px;
            text-align: left;
        }

        .search-section h2 {
            font-size: 24px;
            color: #007bff;
            margin-bottom: 10px;
        }

        .search-row {
            display: flex;
            align-items: center;
            margin-bottom: 10px;
        }

        .search-row button {
            width: 30%;
            height: 40px;
            font-size: 16px;
            display: inline-flex;
            align-items: center;
            justify-content: center;
        }

        .search-row .reset-button {
            margin-right: 10px;
            background-color: #333;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-row .reset-button:hover {
            background-color: grey;
        }

        .search-row .search-button {
            background-color: #007bff;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .search-row .search-button:hover {
            background-color: #0056b3;
        }

        .language-container {
            margin-top: 20px;
            text-align: left;
            display: flex;
            gap: 5px;
        }

        .language-container label {
            display: block;
            margin-bottom: 10px;
            color: #333;
            cursor: pointer;
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            font-size: 16px;
            transition: background-color 0.3s ease, border-color 0.3s ease;
            height: 40px;
            width: 100%;
            line-height: 20px; /* 텍스트 중앙 정렬 */
            box-sizing: border-box;
            text-align: center;
        }

        .language-container label.selected {
            background-color: #007bff;
            color: #fff;
            border-color: #007bff;
        }

        .language-container label input[type="radio"] {
            display: none;
        }

        .features {
            text-align: right;
        }

        /* 검색 이력 섹션 스타일 */
        .history-section {
            margin-top: 20px;
            text-align: left;
        }

        /* 검색 이력 목록 스타일 */
        #historyList {
            display: flex;
            flex-wrap: wrap;
            list-style-type: none;
            padding: 0;
            margin-top: 20px;
        }

        #historyList li {
            width: 42%; /* 가로 크기를 절반으로 */
            margin: 1%; /* 여백 추가 */
            background-color: #f0f0f0;
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            font-size: 14px;
        }

        .delete-button {
            background-color: #e33f3f;
            color: #fff;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            padding: 5px 10px;
            transition: background-color 0.3s ease;
            font-size: 14px;
        }

        .delete-button:hover {
            background-color: grey;
        }

        .search-history-header {
        display: flex;
        justify-content: space-between;
        align-items: center;
        }

        .reset-history-button {
            background-color: #e33f3f;
            color: white;
            border: none;
            border-radius: 5px;
            padding: 5px 10px;
            cursor: pointer;
            transition: background-color 0.3s ease;
        }

        .reset-history-button:hover {
            background-color: grey;
        }

        .tagsearch {
            position: absolute;
            height: 50px;
            width: 50px;
            line-height: 50px;
            top: 10px;
            right: 10px;
            border-radius: 50px;
            background-color: #333;
            opacity: 0.6;
            color: white;
            cursor: pointer;
        }

        .tagsearch:hover{
            opacity: 1;
            transition: opacity 0.3s ease;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>숫자를 입력하세요</h1>
        <input type="tel" id="inputNumber" class="number-input" placeholder="숫자를 입력하세요" oninput="this.value = this.value.replace(/[^0-9]/g, '')" onkeydown="if(event.keyCode == 13) redirectToHtm()">

        <div class="number-buttons">
            <div class="button-row">
                <button onclick="addNumber(7)">7</button>
                <button onclick="addNumber(8)">8</button>
                <button onclick="addNumber(9)">9</button>
            </div>
            <div class="button-row">
                <button onclick="addNumber(4)">4</button>
                <button onclick="addNumber(5)">5</button>
                <button onclick="addNumber(6)">6</button>
            </div>
            <div class="button-row">
                <button onclick="addNumber(1)">1</button>
                <button onclick="addNumber(2)">2</button>
                <button onclick="addNumber(3)">3</button>
            </div>
            <div class="button-row">
                <button class="epic" onclick="resetInput()">초기화</button>
                <button onclick="addNumber(0)">0</button>
                <button class="epic" onclick="redirectToHtm()">이동</button>
            </div>
        </div>

        <div class="search-section">
            <h2>작가명으로 검색</h2>
            <div class="search-row">
                <input type="text" id="searchAuthor" class="search-input" placeholder="작가 이름을 입력하세요" oninput="validateAuthorInput()">
                <button class="reset-button" onclick="resetSearchInput()">초기화</button>
                <button class="search-button" onclick="searchAuthor()">검색</button>
            </div>

            <div class="language-container">
                <label><input type="radio" name="language" value="-all"> All</label>
                <label class="selected"><input type="radio" name="language" value="-korean" checked> 한국어</label>
                <label><input type="radio" name="language" value="-english"> English</label>
                <label><input type="radio" name="language" value="-japanese"> 日本語</label>
            </div>
        </div>
        <div class="tagsearch" onclick="location.href='tagmanager.html'">TAG</div>

        <div class="history-section">
            <button id="clearHistoryButton" class="reset-history-button" onclick="clearSearchHistory()">검색이력 초기화</button>
            <h2>검색 이력</h2> 
            <ul id="historyList" class="history-list"></ul>
        </div>
    </div>

    <script>
        function clearSearchHistory() {
            if (confirm('정말로 모든 검색 이력을 삭제하시겠습니까?')) {
                localStorage.removeItem('searchHistory'); // 로컬 스토리지에서 검색 이력 삭제
                searchHistory = []; // 검색 이력 배열 초기화
                renderSearchHistory(); // 화면 갱신
            }
        }
        function redirectToHtm() {
            var input = document.getElementById('inputNumber').value;
            if (!isNaN(input) && input !== '') {
                var url = 'https://hitomi.la/reader/' + input + '.html';
                window.open(url);
            } else {
                alert('올바른 숫자를 입력하세요!');
            }
        }

        function resetInput() {
            document.getElementById('inputNumber').value = '';
        }

        function addNumber(number) {
            document.getElementById('inputNumber').value += number;
        }
        
        function validateAuthorInput() {
            var input = document.getElementById('searchAuthor').value;
            document.getElementById('searchAuthor').value = input.replace(/[^a-zA-Z0-9 .-]/g, '');
        }

        function searchAuthor() {
            var authorName = document.getElementById('searchAuthor').value.trim();
            var language = document.querySelector('input[name="language"]:checked').value;
            if (authorName === '') {
                alert('작가명을 입력해 주세요');
                return;
            }
            var formattedName = authorName.replace(/ +$/, '').replace(/ /g, '%20');
            var url = 'https://hitomi.la/artist/' + formattedName + language + '.html';
            window.open(url);
        }

        function resetSearchInput() {
            document.getElementById('searchAuthor').value = '';
            document.querySelector('input[name="language"][value="-all"]').checked = true;
        }

        document.querySelectorAll('.language-container input[type="radio"]').forEach(radio => {
            radio.addEventListener('change', () => {
                document.querySelectorAll('.language-container label').forEach(label => label.classList.remove('selected'));
                radio.closest('label').classList.add('selected');
            });
        });
        const maxHistoryCount = 20;
        let searchHistory = JSON.parse(localStorage.getItem('searchHistory')) || [];

        function renderSearchHistory() {
            const historyList = document.getElementById('historyList');
            historyList.innerHTML = '';

            searchHistory.forEach((item, index) => {
                const li = document.createElement('li');

                // 언어 표기 형식에 맞춰 변환
                let languageSuffix = '';
                switch (item.language) {
                    case '-korean': languageSuffix = '_K'; break;
                    case '-english': languageSuffix = '_E'; break;
                    case '-japanese': languageSuffix = '_J'; break;
                    case '-all': languageSuffix = '_All'; break;
                }

                // 작가명을 최대 15자로 자름
                const truncatedAuthor = item.author.length > 12 ? item.author.slice(0, 12) + '...' : item.author;
                li.textContent = `${truncatedAuthor}${languageSuffix}`;

                // 삭제 버튼 생성 및 클릭 이벤트 추가
                const deleteButton = document.createElement('button');
                deleteButton.textContent = 'x';
                deleteButton.classList.add('delete-button');
                deleteButton.onclick = (event) => {
                    event.stopPropagation(); // 클릭 이벤트가 li까지 전달되지 않도록 막기
                    deleteHistoryItem(index);
                };

                li.appendChild(deleteButton);
                li.onclick = () => searchAuthor(item.author, item.language); // 검색 기능
                historyList.appendChild(li);
                });
        }

        // 검색 함수 수정: 검색 이력 저장
        function searchAuthor(author = null, language = null) {
            let authorName = author || document.getElementById('searchAuthor').value.trim();
            let selectedLanguage = language || document.querySelector('input[name="language"]:checked').value;

            if (authorName === '') {
                alert('작가명을 입력해 주세요');
                return;
            }

            // 검색 이력 저장
            addSearchHistory(authorName, selectedLanguage);

            const formattedName = authorName.replace(/ +$/, '').replace(/ /g, '%20');
            const url = `https://hitomi.la/artist/${formattedName}${selectedLanguage}.html`;
            window.open(url);
        }

        // 검색 이력 저장 함수
        function addSearchHistory(author, language) {
            const historyItem = { author, language };

            // 중복 이력 방지
            searchHistory = searchHistory.filter(item => item.author !== author || item.language !== language);

            // 이력 추가
            searchHistory.unshift(historyItem);

            // 최대 이력 개수 초과 시 오래된 것 삭제
            if (searchHistory.length > maxHistoryCount) {
                searchHistory.pop();
            }

            localStorage.setItem('searchHistory', JSON.stringify(searchHistory));
            renderSearchHistory();
        }

        // 검색 이력 삭제 함수
        function deleteHistoryItem(index) {
            searchHistory.splice(index, 1); // 해당 인덱스 항목 삭제
            localStorage.setItem('searchHistory', JSON.stringify(searchHistory)); // 변경된 이력 저장
            renderSearchHistory(); // UI 업데이트
        }

        // 초기화 함수
        function resetSearchInput() {
            document.getElementById('searchAuthor').value = '';
            document.querySelector('input[name="language"][value="-all"]').checked = true;
        }

        // 페이지 로드 시 검색 이력 렌더링
        document.addEventListener('DOMContentLoaded', renderSearchHistory);
    </script>
</body>
</html>
